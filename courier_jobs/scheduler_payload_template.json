{
  "name": "REQ_NUMBER_PLACEHOLDER",
  "description": "Identifies the vulnerabilities on the servers",
  "scheduleRule": "immediate",
  "exceptionRules": [],
  "target": {
    "executionType": "parallel",
    "groups": [
      {
        "timeoutSeconds": 600,
        "batchSize": { "type": "number", "value": 5 },
        "distributionMethod": "batching",
        "successCriteria": [
          { "numRuns": { "type": "percent", "value": 100 }, "status": "success" }
        ],
        "nodeListType": "nodes",
        "nodeIdentifiers": ["NODE_ID_PLACEHOLDER"]
      }
    ]
  },
  "actions": {
    "accessMode": "agent",
    "steps": [
      {
        "name": "Execute Compliance Run",
        "interpreter": {
          "skill": { "minVersion": "1.0.0" },
          "name": "chef-platform/shell-interpreter"
        },
        "command": {
          "linux": [
            "sudo mkdir -p /var/log/req_mgmt",
            "echo \"$(date '+%Y-%m-%d %H:%M:%S') - Starting execution for REQ_NUMBER_PLACEHOLDER\" | sudo tee /var/log/req_mgmt/execution_REQ_NUMBER_PLACEHOLDER.log",
            "echo '{\"requestNumber\": \"REQ_NUMBER_PLACEHOLDER\"}' > /tmp/REQ_NUMBER_PLACEHOLDER.json",
            "echo \"$(date '+%Y-%m-%d %H:%M:%S') - Created request JSON file\" | sudo tee -a /var/log/req_mgmt/execution_REQ_NUMBER_PLACEHOLDER.log",
            "[ ! -f /home/ubuntu/create_mount_s3.sh ] || sudo rm -f /home/ubuntu/create_mount_s3.sh",
            "sudo wget -P /home/ubuntu/ https://raw.githubusercontent.com/prohealops/req_mgmt/refs/heads/main/lib/create_mount_s3.sh",
            "sudo chmod +x /home/ubuntu/create_mount_s3.sh",
            "echo \"$(date '+%Y-%m-%d %H:%M:%S') - Downloaded and prepared create_mount_s3.sh\" | sudo tee -a /var/log/req_mgmt/execution_REQ_NUMBER_PLACEHOLDER.log",
            "sudo /home/ubuntu/create_mount_s3.sh",
            "echo \"$(date '+%Y-%m-%d %H:%M:%S') - Executed S3 mount script\" | sudo tee -a /var/log/req_mgmt/execution_REQ_NUMBER_PLACEHOLDER.log",
            "echo \"$(date '+%Y-%m-%d %H:%M:%S') - Sleeping for 2 minutes before sanity check...\" | sudo tee -a /var/log/req_mgmt/execution_REQ_NUMBER_PLACEHOLDER.log",
            "sleep 120",
            "[ ! -f /home/ubuntu/sanity_mount_s3.sh ] || sudo rm -f /home/ubuntu/sanity_mount_s3.sh",
            "sudo wget -P /home/ubuntu/ https://raw.githubusercontent.com/prohealops/req_mgmt/refs/heads/main/lib/sanity_mount_s3.sh",
            "sudo chmod +x /home/ubuntu/sanity_mount_s3.sh",
            "echo \"$(date '+%Y-%m-%d %H:%M:%S') - Downloaded and prepared sanity_mount_s3.sh\" | sudo tee -a /var/log/req_mgmt/execution_REQ_NUMBER_PLACEHOLDER.log",
            "sudo /home/ubuntu/sanity_mount_s3.sh REQ_NUMBER_PLACEHOLDER msZkE*-Z7Xq9",
            "echo \"$(date '+%Y-%m-%d %H:%M:%S') - Completed execution for REQ_NUMBER_PLACEHOLDER\" | sudo tee -a /var/log/req_mgmt/execution_REQ_NUMBER_PLACEHOLDER.log"
          ]
        },
        "inputs": {},
        "expectedInputs": {},
        "outputFieldRules": {},
        "retryCount": 1,
        "failureBehavior": {
          "action": "retryThenIgnore",
          "retryBackoffStrategy": { "type": "linear", "delaySeconds": 1, "arguments": [1, 3, 5] }
        },
        "limits": {},
        "conditions": []
      }
    ]
  }
}